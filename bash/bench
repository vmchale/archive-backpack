#!/usr/bin/env bash

set -e

# star - Schily tar
# bench 'tarlz -xf llvm-9.0.0.src.tar.lz'
# qtar - http://inai.de/projects/hxtools/ https://inai.de/files/libhx/
# ptar - perl tar
# minitar - gem install minitar-cli
# arc - go tar
# tar_rs (star) - rust tar
# htar - haskell tar (tar library)
for tarball in llvm-9.0.0.src.tar.gz llvm-9.0.0.src.tar.xz llvm-9.0.0.src.tar.bz2
do
    bench "python3 -m tarfile -e $tarball" "bsdtar -xf $tarball" "hstar unpack $tarball" "tar xf $tarball" "star xf $tarball" "arc unarchive $tarball" "busybox tar xf $tarball" --before 'rm -rf llvm-9.0.0.src'
done

bench 'bsdtar -xf llvm-9.0.0.src.tar.lz4' \
    'hstar unpack llvm-9.0.0.src.tar.lz4' \
    'lz4 -cd llvm-9.0.0.src.tar.lz4 | busybox tar xf -' \
    'lz4 -cd llvm-9.0.0.src.tar.lz4 | tar xf -' \
    'lz4 -cd llvm-9.0.0.src.tar.lz4 | star xf -' --before 'rm -rf llvm-9.0.0.src'

for tarball in llvm-9.0.0.src.tar.lz llvm-9.0.0.src.tar.zst
do
    bench "bsdtar -xf $tarball" "hstar unpack $tarball" "tar xf $tarball" "star xf $tarball" --before 'rm -rf llvm-9.0.0.src'
done
bench 'arc unarchive llvm-9.0.0.src.tar.zst'
bench 'lzip -cd llvm-9.0.0.src.tar.lz | busybox tar xf -' \
    'zstd -cd llvm-9.0.0.src.tar.zst | busybox tar xf -'

# bench 'arc unarchive llvm-9.0.0.src.tar.br' \
    # 'hstar unpack llvm-9.0.0.src.tar.br' \
    # 'brotli -cd llvm-9.0.0.src.tar.br | busybox tar xf -' \
    # 'brotli -cd llvm-9.0.0.src.tar.br | tar xf -' \
    # 'brotli -cd llvm-9.0.0.src.tar.br | star xf -' \
    # 'brotli -cd llvm-9.0.0.src.tar.br | bsdtar -xf -'

tar_rs="$HOME/.cargo/bin/star"

bench "$tar_rs x llvm-9.0.0.src.tar.zst" \
    "$tar_rs x llvm-9.0.0.src.tar.xz" \
    "$tar_rs x llvm-9.0.0.src.tar.gz"

bench 'htar -xzf llvm-9.0.0.src.tar.gz' \
    'htar -xjf llvm-9.0.0.src.tar.bz2'

bench 'pax -rzf llvm-9.0.0.src.tar.gz' \
    'ptar xf llvm-9.0.0.src.tar.gz' \
    'minitar extract llvm-9.0.0.src.tar.gz'
